# Daemon Intel MCP Server - LLM Integration Guide

## Overview
Daemon Intel is an MCP (Model Context Protocol) server for blockchain intelligence. It provides tools for risk analysis, address labeling, and balance/transaction queries across multiple chains.

Base URL: https://intel-api.daemonprotocol.com

## MCP Endpoints

### 1. SSE Connection
GET /sse
- Establishes SSE connection and returns sessionId
- Response: SSE stream with `event: endpoint` containing sessionId
- **IMPORTANT**: Connection must remain open (keep-alive) for session to persist

### 2. Tool Execution
POST /message?sessionId={sessionId}
- Content-Type: application/json
- Body: JSON-RPC 2.0 format

### 3. List Tools
GET /tools
- Returns all available tools with inputSchema

### 4. Health Check
GET /health

## Connection Flow

1. Open SSE connection: `GET https://intel-api.daemonprotocol.com/sse`
2. Keep connection alive in background (use threading/async)
3. Parse sessionId from SSE event: `data: /message?sessionId={id}`
4. Use sessionId for tool calls: `POST https://intel-api.daemonprotocol.com/message?sessionId={id}`
5. Maintain SSE connection throughout session lifecycle

**CRITICAL**: SSE connection must stay open. If connection closes, session is deleted and tool calls will fail with "Session not found".

## Available Tools (14 total)

### Risk Analysis Tools

#### analyze_with_cyclops
Comprehensive risk analysis for any address/entity. Works for ALL chains.
- Parameters: { input: string } - Blockchain address or entity name
- Returns: Risk score, sanctions status, labels, entity information

#### get_address_label
Get labels and risk indicators for a blockchain address. Works for ALL chains.
- Parameters: { address: string } - Blockchain address
- Returns: Labels, risk indicators, entity associations

#### analyze_with_daemon_agent
Deep blockchain analysis with threat detection. ONLY Solana and Ethereum.
- Parameters: { address: string } - Solana or Ethereum address
- Returns: Detailed threat analysis, behavioral patterns

#### check_risk_engine
Risk alerts and exposure analysis. Ethereum ONLY.
- Parameters: { address: string } - Ethereum address (0x...)
- Returns: Risk alerts, exposure metrics, compliance flags

### Solana Tools

#### get_solana_balance
Get SOL balance for a Solana address.
- Parameters: { address: string } - Solana address (Base58, 32-44 chars)
- Returns: { balance: "X.XXXX SOL", raw: {...} }

#### get_solana_transactions
Get recent transaction signatures for a Solana address.
- Parameters: { address: string, limit?: number (default: 10, max: 100) }
- Returns: Array of transaction signatures with timestamps

#### get_solana_tokens
Get all SPL token holdings for a Solana address.
- Parameters: { address: string }
- Returns: Token accounts with balances

### Ethereum Tools

#### get_eth_balance
Get ETH balance for an Ethereum address.
- Parameters: { address: string } - Ethereum address (0x + 40 hex)
- Returns: { balance: "X.XXXX ETH", raw: {...} }

#### get_eth_transactions
Get recent transactions for an Ethereum address.
- Parameters: { address: string }
- Returns: Transaction list

#### get_eth_token_transfers
Get ERC20 token transfer history for an Ethereum address.
- Parameters: { address: string }
- Returns: Token transfer history

### Multi-Chain EVM Tools

#### get_evm_balance
Get native token balance for any supported EVM chain.
- Parameters: { address: string, chain: string }
- Supported chains: ETH, BASE, ARBITRUM, OPTIMISM, POLYGON, ZKSYNC, AVALANCHE, BSC, HYPEREVM, MONAD, LISK, ENI
- Returns: { chain: "X", balance: "X.XXXXXX TOKEN" }

#### get_evm_transactions
Get transaction count for any supported EVM chain.
- Parameters: { address: string, chain: string }
- Supported chains: Same as get_evm_balance
- Returns: { chain: "X", transactionCount: N }

### OneChain Tools

#### get_onechain_balance
Get OCT balance for a OneChain address.
- Parameters: { address: string } - OneChain address (0x + 64 hex chars)
- Returns: { balance: "X.XXXX OCT", raw: {...} }

#### get_onechain_objects
Get owned objects for a OneChain address.
- Parameters: { address: string }
- Returns: { count: N, objects: {...} }

## Address Format Detection

| Chain | Format | Detection |
|-------|--------|-----------|
| Solana | Base58, 32-44 chars (no 0/O/I/l) | Regex |
| Ethereum | 0x + 40 hex chars | RPC check |
| OneChain | 0x + 64 hex chars | Length check |
| EVM chains | 0x + 40 hex chars | RPC check per chain |

## JSON-RPC Request Format

```json
{
  "jsonrpc": "2.0",
  "id": 1234567890,
  "method": "tools/call",
  "params": {
    "name": "tool_name",
    "arguments": {
      "param1": "value1"
    }
  }
}
```

## JSON-RPC Response Format

Success:
```json
{
  "jsonrpc": "2.0",
  "id": 1234567890,
  "result": {
    "content": [{ "type": "text", "text": "..." }],
    "isError": false
  }
}
```

Error:
```json
{
  "jsonrpc": "2.0",
  "id": 1234567890,
  "error": {
    "code": -32600,
    "message": "Error description"
  }
}
```

## Chain Support Matrix

| Tool | Solana | Ethereum | EVM Chains | OneChain |
|------|--------|----------|------------|----------|
| analyze_with_cyclops | ✓ | ✓ | ✓ | ✓ |
| get_address_label | ✓ | ✓ | ✓ | ✓ |
| analyze_with_daemon_agent | ✓ | ✓ | ✗ | ✗ |
| check_risk_engine | ✗ | ✓ | ✗ | ✗ |
| get_solana_* | ✓ | ✗ | ✗ | ✗ |
| get_eth_* | ✗ | ✓ | ✗ | ✗ |
| get_evm_* | ✗ | ✓ | ✓ | ✗ |
| get_onechain_* | ✗ | ✗ | ✗ | ✓ |

## Native Tokens by Chain

- ETH, BASE, ARBITRUM, OPTIMISM, ZKSYNC: ETH
- POLYGON: MATIC
- AVALANCHE: AVAX
- BSC: BNB
- HYPEREVM: HYPE
- MONAD: MON
- LISK: LSK
- ENI: ENI
- OneChain: OCT
- Solana: SOL

## Example Python Implementation

```python
import requests
import threading
import time

session_id = None

def keep_sse_alive():
    global session_id
    response = requests.get('https://intel-api.daemonprotocol.com/sse', stream=True, timeout=60)
    for line in response.iter_lines():
        if line:
            decoded = line.decode('utf-8')
            if decoded.startswith('data: '):
                path = decoded[6:]
                if 'sessionId=' in path:
                    session_id = path.split('sessionId=')[1]

# Start SSE in background
sse_thread = threading.Thread(target=keep_sse_alive, daemon=True)
sse_thread.start()

# Wait for sessionId
while not session_id:
    time.sleep(0.1)

# Call tool
response = requests.post(
    f'https://intel-api.daemonprotocol.com/message?sessionId={session_id}',
    json={
        "jsonrpc": "2.0",
        "id": 1,
        "method": "tools/call",
        "params": {
            "name": "get_solana_balance",
            "arguments": {"address": "..."}
        }
    }
)
```
